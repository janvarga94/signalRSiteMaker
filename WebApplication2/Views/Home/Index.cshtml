@{
    ViewData["Title"] = "Home Page";
}


<environment include="Development">
    <link rel="stylesheet" href="~/css/siteMaker.css" />
</environment>
<environment exclude="Development">
    <link rel="stylesheet" href="~/css/siteMaker.min.css" />
</environment>


<script>

    var myHubProxy = window.myHubProxy = $.connection.hub.createHubProxy("janHub");

    myHubProxy.on("elementAdded", data => {
        var element = $.parseHTML(data.newElement)[0];
        if (data.parentId) {
            document.getElementById(data.parentId).appendChild(element);
        } else {
            document.body.appendChild(element);
        }
    });
    myHubProxy.on("elementRemoved", removedId => {
        $("#" + removedId).remove();
    });
    myHubProxy.on("elementUpdated", updated => {
        console.log("updating");
        var updatedElement = $.parseHTML(updated)[0];
        var old = $("#" + updatedElement.id);
        old.replaceWith(updated);
        attachHandlersToNewCreatedElement(document.getElementById(updatedElement.id));

    });

    myHubProxy.on("receiveChatMessage", (nickname, message) => {
        var tagsToReplace = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;'
        };

        function replaceTag(tag) {
            return tagsToReplace[tag] || tag;
        }

        function safe_tags_replace(str) {
            return str.replace(/[&<>]/g, replaceTag);
        }

        $("#chatMessages").prepend(safe_tags_replace(nickname) + ": " + safe_tags_replace(message) + "\n");
    })
    

    $.connection.hub.start().done(() => {
        console.log("connection started")
        myHubProxy.invoke("getInitData").then(data => {
            console.log(data.currentDocument)
            $(document.body).append($.parseHTML(data.currentDocument));
            var elements = $(document.body).children().filter((index, ell) => { return ell.id && ell.id != "engine" });
            elements.each((indx, el) => { attachHandlersToNewCreatedElement(el); });
        })

    });

</script>




<div id="engine" style="position:absolute; left:0px; top:0px">
    <!-- engine are components to work with project, everithing elese is final result of project-->
    <img id="leftTopRot" src="editImages/rot1.png" width="30" height="30">
    <img id="rightBottomRot" src="editImages/rot2.png" width="30" height="30">
    <img id="leftTop" src="editImages/a.png">
    <img id="rightBottom" src="editImages/b.png">
    <img id="replace" src="editImages/move.png" height="40" width="40">
    <div id="editor">
        Next creating&emsp;<input type="text" value="div" size="8" id="whichTag">
        <br>
        --Resize&emsp;
        <input checked type="radio" name="rad1" id="radR1">style
        <input type="radio" name="rad1" id="radR2">attribute
        <Br>
        --Align<br>
        <img width="30" id="elAlignLeft" src="editImages/elAlignLeft.jpg">
        <img width="30" id="elAlignCenter" src="editImages/elAlignCenter.jpg">
        <img width="30" id="elAlignRight" src="editImages/elAlignRight.jpg">
        <Br>
        set Style: <input id="setStyle" type="text" size="40">
        <br>
        set Attribute: <input id="setAttr" type="text" size="40">
        <br>
        --Shadows--
        <br>
        Horizontal&nbsp;<input id="sh1" max="100" value="0" type="range">
        <br>
        Vertical&nbsp;<input id="sh2" max="100" value="0" type="range">
        <br>
        Blur&nbsp;<input id="sh3" max="100" value="0" type="range">
        <br>
        Spread&nbsp;<input id="sh4" max="100" value="0" type="range">
        <br>
        Color&nbsp; <input id="csh" type="text">
        <br>
        &emsp;&emsp;&emsp;&emsp;Text <img src="editImages/alignLeft.jpg" width="20" id="TextAlignLeft">
        <img src="editImages/alignCenter.jpg" width="20" id="TextAlignCenter">
        <img src="editImages/alignRight.jpg" width="20" id="TextAlignRight">
        <br>
        <textarea disabled style="resize:none" id="text" rows="7" cols="50"></textarea>
        <div id="jn4vkd0sj59j6lyvpgz" style="background-color: rgba(0, 0, 0, 0.1); position: fixed; left: 500.5px; top: 46px; width: 361px; height: 368px;">
            <button  onclick="sendMessage()" id="1tk9lrjilpmj6lyw9co" style="background-color: rgba(0, 0, 0, 0.1); position: absolute; left: 275px; top: 337px; width: 77px; height: 26px;">
                send
            </button>
            <span id="6szhpc2j9i3j6lyxh87" style="background-color: rgba(0, 0, 0, 0.1); position: absolute; left: 132px; top: 300.5px; width: 73px; height: 27px;">
            nickname:
            </span>
            <input id="nicknameInput" style="background-color: rgba(0, 0, 0, 0.1); position: absolute; left: 213.5px; top: 301.5px; width: 142px; height: 29px;">
            <input id="messageInput" style="background-color: rgba(0, 0, 0, 0.1); position: absolute; left: 8.5px; top: 336px; width: 264px; height: 26px;">
            <textarea id="chatMessages" style="background-color: rgba(0, 0, 0, 0.1); position: absolute; left: 7.5px; top: 9px; width: 344px; height: 286px;"></textarea>
        </div>
    </div>
    <environment include="Development">
        <script src="~/js/globalVars.js"></script>
        <script src="~/js/functions.js"></script>
        <script src="~/js/keys.js"></script>
        <script src="~/js/mouse.js"></script>
        <script src="~/js/editor.js"></script>
        <script src="~/js/chat.js"></script>
    </environment>
    <environment exclude="Development">
        <script src="~/js/siteMaker.min.js"></script>
    </environment>
</div>



